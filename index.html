<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Herron Weather App</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  </head>

  <body class="bg-dark">
    <!-- Login Form -->
    <form
      id="frmLogin"
      class="card col-12 col-md-6 offset-md-3 col-lg-4 offset-lg-4 mt-5"
    >
      <div class="card-body">
        <h1 class="text-center mt-2">Swollen Hippo</h1>
        <h3 class="text-center mt-2">Login</h3>

        <div class="form-floating mt-4 mb-2">
          <input
            id="txtLoginEmail"
            class="form-control"
            type="email"
            placeholder="Email"
            aria-label="Input for Email Address"
          />
          <label for="txtLoginEmail">Email:</label>
          <div id="txtLoginEmail-error" class="error-message text-danger"></div>
        </div>

        <button class="btn btn-primary col-12 mt-3" type="button" id="btnLogin">
          Login
        </button>
        <button class="btn btn-link col-12" type="button" id="btnShowRegister">
          Need an account? Register here
        </button>
      </div>
    </form>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      // Start GLobal Variables
      const regEmail =
        /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;
      const strBaseURL = "https://api.open-meteo.com/v1/forecast";
      // What to add to URL (?latitude=52.52&longitude=13.41&hourly=temperature_2m)
      // End Global Variables

      // Start Functions to get Location using Geolocation API
      const strLatitude = "";
      const strLongitude = "";
      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition);
        } else {
          console.log("Geolocation is not supported by this browser.");
        }
      }

      function showPosition(position) {
        strLatitude = position.coords.latitude;
        strLongitude = position.coords.longitude;
      }

      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(position => {
            const lat = position.coords.latitude.toFixed(2);
            const lon = position.coords.longitude.toFixed(2);
            document.getElementById("location").innerText = `Lat: ${lat}, Lon: ${lon}`;
            fetchWeather(lat, lon);
          }, () => {
            Swal.fire({
              title: "Location Error",
              text: "Location access denied.",
              icon: "error"
            });
          });
        } else {
          Swal.fire({
            title: "Geolocation Error",
            text: "Geolocation is not supported by this browser.",
            icon: "error"
          });
        }
      }
      // End Functions to get Location using Geolocation API

      // Start Weather Function using OpenMeteo API
      function fetchWeather(lat, lon) {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m&temperature_unit=fahrenheit&timezone=auto`;
        fetch(url)
          .then(response => response.json())
          .then(data => {
            document.getElementById("temperature").innerText = `Temperature: ${data.current.temperature_2m}Â°F`;
            document.getElementById("humidity").innerText = `Humidity: ${data.current.relative_humidity_2m}%`;
          })
          .catch(() => {
            Swal.fire({
              title: "Error",
              text: "Error fetching weather data",
              icon: "error"
            });
          });
      }
      // Weather Weather Function using OpenMeteo API

      // Validation function for latitude and longitude
      function validateLatitudeLongitude(strLatitude, strLongitude) {
        const regLatLon = /^-?\d{1,2}\.\d{2}$/;
        return regLatLon.test(strLatitude) && regLatLon.test(strLongitude);
      }

      function clearError(elementId) {
        const element = document.querySelector(`#${elementId}`);
        const errorElement = document.querySelector(`#${elementId}-error`);
        element.classList.remove("error-input");
        errorElement.textContent = "";
      }

      // Weather form validation
      document.querySelector("#btnLogin").addEventListener("click", (e) => {
        // Validate the data
        let blnError = false;
        let strError = "";

        if (!regLatLon.test(strLatitude, strLongitude)) {
          blnError = true;
          strError += "<p>Latitude and Longitude are not Valid</p>";
        }
        if (blnError == true) {
          Swal.fire({
            title: "Look a little closer, there are errors",
            html: strError,
            icon: "error",
          });
        } else {
          // Call our function to create the account
        }
      });

      // Validation for Registration form
      document.querySelector("#btnRegister").addEventListener("click", (e) => {
        let blnError = false;

        // Email validation
        const strEmail = document.querySelector("#txtEmail").value.trim();
        if (!validateEmail(strEmail)) {
          blnError = true;
          showError("txtEmail", "Please enter a valid email address");
        } else {
          clearError("txtEmail");
        }

        if (blnError) {
          Swal.fire({
            title: "Registration Error",
            text: "Please correct the highlighted fields",
            icon: "error",
          });
        } else {
          Swal.fire({
            title: "Success!",
            text: "Your registration was successful",
            icon: "success",
          }).then(() => {
            // if successful registration, displays login form
            document.querySelector("#frmRegister").style.display = "none";
            document.querySelector("#frmLogin").style.display = "block";
          });
        }
      });
    </script>
  </body>
</html>